<table style="width: 100%">
  <tr>
    <td>
      <button ng-click="region.showAdd()">AddNewRegion</button>
    </td>
    <td>
      <select ng-model="search.estateName" ng-options="eName as eName for (eName, regions) in estates| orderBy: eName" />
    </td>
    <td>
      <input placeholder="Name Search" type="search" ng-model="search.regionName" style="width: 10em">
    </td>
  </tr>
</table>
<table style="width: 100%">
  <tbody ng-repeat="(eName, regions) in estates | orderBy: eName | filter:search.estateName" ng-show="shouldShow(eName)">
    <tr>
      <td colspan="6">
        <h3>{{eName}}</h3>
      </td>
    </tr>
    <tr ng-repeat="r in regions|orderBy: 'Name'" ng-class-odd="'odd'" ng-class-even="'even'" ng-show="r.Name.includes(search.regionName)">
      <td>{{r.Name}}</td>
      <td ng-if="r.Status.Running"> {{r.Status.CPUPercent.toFixed(2)}}% CPU</td>
      <td ng-if="r.Status.Running"> {{r.Status.MemKB}} KB</td>
      <td ng-if="r.Status.Running">Up {{humanReadableUptime(r.Status.Uptime)}}</td>
      <td ng-if="r.Status.Running">{{r.Status.simStats.RootAg}} Users</td>
      <td ng-if="!r.Status.Running" colspan="4">~ is not running</td>
      <td align="right">
        <button ng-if="!r.Status.Running" ng-click="region.start(r)" class="btn btn-xs btn-default">Start</button>
        <button ng-if="r.Status.Running" ng-click="region.stop(r)" class="btn btn-xs btn-default">Stop</button>
        <button ng-if="r.Status.Running" ng-click="region.kill(r)" class="btn btn-xs btn-danger">Kill</button>
        <button ng-click="region.content(r)" ng-if="r.Status.Running" class="btn btn-xs btn-default">Content</button>
        <button ng-click="region.manage(r)" ng-if="auth.AccessLevel > 249" class="btn btn-xs btn-default">Manage</button>
        <button ng-click="region.log(r)" class="btn btn-xs btn-default">log</button>
      </td>
    </tr>
  </tbody>
</table>

<script type="text/ng-template" id="manageSettingsModal.html">
  <div class="modal-header">
    <table>
      <tr>
        <td><h3 class="modal-title">{{region.Name}}</h3></td>
        <td><button style="float:right" ng-click="region.remove(r)">Delete</button></td>
      </tr>
    </table>
  </div>
  <div class="modal-body">
    <table>
      <tr>
        <td>Change Estate</td>
        <td colspan="2"><select ng-model="newEstate" ng-init="newEstate=region.estate" ng-options="est.Name for (eName, est) in estates"></select></td>
        <td><button ng-click="setEstate(newEstate)">Set</button></td>
      </tr>
      <tr>
        <td>Change Host</td>
        <td colspan="2"><select ng-model="newHost" ng-init="newHost=region.host" ng-options="h.Hostname for (id, h) in hosts"></select></td>
        <td><button ng-click="setHost(newHost)">Set</button></td>
      </tr>
      <tr>
        <form>
        <td>Change Position</td>
        <td><label>X</label><input ng-model="locX" ng-init="locX=region.LocX" type="number" min="0" step="1" required/></td>
        <td><label>Y</label><input ng-model="locY" ng-init="locY=region.LocY" type="number" min="0" step="1" required/></td>
        <td><button type="submit" ng-click="setXY(locX,locY)">Set</button></td>
        </form>
      </tr>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn btn-warning" ng-click="close()">Close</button>
  </div>
</script>
